<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Activewear Store</title>
    <link rel="stylesheet" href="/css/admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="admin-layout">
        <!-- Sidebar -->
        <nav class="admin-sidebar">
            <div class="sidebar-header">
                <h3><i class="fas fa-cogs"></i> Admin Panel</h3>
            </div>
            <ul class="sidebar-menu">
                <li class="active"><a href="/admin/dashboard"><i class="fas fa-chart-line"></i> Dashboard</a></li>
                <li><a href="/admin/users"><i class="fas fa-users"></i> Quản lý người dùng</a></li>
                <li><a href="/admin/products"><i class="fas fa-box"></i> Quản lý sản phẩm</a></li>
                <li><a href="/admin/categories"><i class="fas fa-tags"></i> Danh mục</a></li>
                <li><a href="/admin/brands"><i class="fas fa-trademark"></i> Thương hiệu</a></li>
                <li><a href="/admin/banners"><i class="fas fa-image"></i> Quản lý Banner</a></li>
                <li><a href="/admin/sports"><i class="fas fa-running"></i> Quản lý Môn Thể Thao</a></li>
                <li><a href="/"><i class="fas fa-home"></i> Về trang chủ</a></li>
                <li><a href="/logout"><i class="fas fa-sign-out-alt"></i> Đăng xuất</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <div class="admin-main">
            <div class="admin-header">
                <h1>Dashboard</h1>
                <div class="admin-user">
                    <span th:if="${#authentication.principal instanceof T(com.example.datn.auth.CustomUserDetails)}">
                        Xin chào, <strong th:text="${#authentication.principal.domainUser.ten}">Admin</strong>
                    </span>
                </div>
            </div>

            <div class="admin-content">
                <!-- Statistics Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon users">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 th:text="${stats.totalUsers}">0</h3>
                            <p>Tổng người dùng</p>
                            <small th:text="${stats.activeUsers} + ' đang hoạt động'">0 đang hoạt động</small>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon products">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="stat-info">
                            <h3 th:text="${stats.totalProducts}">0</h3>
                            <p>Tổng sản phẩm</p>
                            <small th:text="${stats.activeProducts} + ' đang bán'">0 đang bán</small>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon revenue">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="stat-info">
                            <h3 th:text="${#numbers.formatDecimal(stats.todayRevenue, 0, 'COMMA', 0, 'POINT')} + '₫'">0₫</h3>
                            <p>Doanh thu hôm nay</p>
                            <small>Hôm nay</small>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon revenue">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-info">
                            <h3 th:text="${#numbers.formatDecimal(stats.monthRevenue, 0, 'COMMA', 0, 'POINT')} + '₫'">0₫</h3>
                            <p>Doanh thu tháng này</p>
                            <small>Tháng hiện tại</small>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon sports">
                            <i class="fas fa-running"></i>
                        </div>
                        <div class="stat-info">
                            <h3 th:text="${totalSports}">0</h3>
                            <p>Tổng môn thể thao</p>
                            <small th:text="${activeSports} + ' đang hoạt động'">0 đang hoạt động</small>
                        </div>
                    </div>
                </div>

                <!-- Revenue Charts -->
                <div class="charts-section">
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-bar"></i> Biểu đồ doanh thu</h3>
                            <div class="chart-controls">
                                <button class="chart-btn active" data-period="weekly">Tuần</button>
                                <button class="chart-btn" data-period="monthly">Tháng</button>
                                <button class="chart-btn" data-period="yearly">Năm</button>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Recent Users and Top Products -->
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <h3><i class="fas fa-user-plus"></i> Người dùng mới</h3>
                        <div class="recent-users">
                            <div th:each="user : ${recentUsers}" class="user-item">
                                <div class="user-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="user-info">
                                    <strong th:text="${user.ten}">Tên người dùng</strong>
                                    <small th:text="${user.email}">email@example.com</small>
                                    <span th:text="${#temporals.format(user.ngayTao, 'dd/MM/yyyy HH:mm')}" class="date">01/01/2024</span>
                                </div>
                                <div class="user-status">
                                    <span th:class="'status ' + (${user.hoatDong} ? 'active' : 'inactive')" 
                                          th:text="${user.hoatDong} ? 'Hoạt động' : 'Không hoạt động'">Hoạt động</span>
                                </div>
                            </div>
                        </div>
                        <a href="/admin/users" class="view-all">Xem tất cả người dùng <i class="fas fa-arrow-right"></i></a>
                    </div>

                    <div class="dashboard-card">
                        <h3><i class="fas fa-fire"></i> Sản phẩm hot</h3>
                        <div class="top-products">
                            <div th:each="product : ${topProducts}" class="product-item">
                                <div class="product-image">
                                    <img th:src="${product.anhChinh}" th:alt="${product.ten}" onerror="this.src='/images/no-image.jpg'">
                                </div>
                                <div class="product-info">
                                    <strong th:text="${product.ten}">Tên sản phẩm</strong>
                                    <small th:text="${product.thuongHieu?.ten}">Thương hiệu</small>
                                    <div class="product-stats">
                                        <span><i class="fas fa-eye"></i> <span th:text="${product.luotXem}">0</span> lượt xem</span>
                                        <span><i class="fas fa-shopping-cart"></i> <span th:text="${product.daBan}">0</span> đã bán</span>
                                    </div>
                                </div>
                                <div class="product-price">
                                    <span th:text="${#numbers.formatDecimal(product.gia, 0, 'COMMA', 0, 'POINT')} + '₫'">0₫</span>
                                </div>
                            </div>
                        </div>
                        <a href="/admin/products" class="view-all">Xem tất cả sản phẩm <i class="fas fa-arrow-right"></i></a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let revenueChart;
        let currentPeriod = 'weekly';

        // Initialize chart
        function initChart() {
            const ctx = document.getElementById('revenueChart').getContext('2d');
            revenueChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Doanh thu (₫)',
                        data: [],
                        backgroundColor: 'rgba(54, 162, 235, 0.8)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return new Intl.NumberFormat('vi-VN').format(value) + '₫';
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Doanh thu: ' + new Intl.NumberFormat('vi-VN').format(context.parsed.y) + '₫';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Load chart data
        function loadChartData(period) {
            const url = `/admin/api/chart/${period}`;
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    revenueChart.data.labels = data.labels;
                    revenueChart.data.datasets[0].data = data.data;
                    revenueChart.update();
                })
                .catch(error => {
                    console.error('Error loading chart data:', error);
                });
        }

        // Chart control buttons
        document.addEventListener('DOMContentLoaded', function() {
            initChart();
            loadChartData('weekly');

            // Chart period buttons
            document.querySelectorAll('.chart-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active class from all buttons
                    document.querySelectorAll('.chart-btn').forEach(b => b.classList.remove('active'));
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    currentPeriod = this.dataset.period;
                    loadChartData(currentPeriod);
                });
            });
        });
    </script>
</body>
</html>
